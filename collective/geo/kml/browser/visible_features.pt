<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:i18n="http://xml.zope.org/namespaces/i18n"
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     class="geoVisibleFeatures"
     id="geo-visible-features"
     i18n:domain="collective.geo.kml"
     tal:condition="view/displayGeoVisibleFeatures"
     tal:define="site_properties context/portal_properties/site_properties;
      use_view_action  site_properties/typesUseViewActionInListings|python:();">

    <!-- see http://www.mail-archive.com/users@openlayers.org/msg10749.html -->
    <script type="text/javascript" charset="iso-8859-1">
    	function changeFeatureVisibility(id, flag) {
            var mapLayer = kml;
            var featureObject = mapLayer.features[id];

            if (flag){
               featureObject.style = featureObject.originalStyle;
            } else {
               mapLayer.events.triggerEvent("featureunselected", {feature: featureObject});
               featureObject.originalStyle = featureObject.style;
               featureObject.style = OpenLayers.Feature.Vector.style['delete'];
           //    mapLayer.drawFeature(featureObject, {display: "none"});
            }
            mapLayer.drawFeature(featureObject); 
        }
        function changeAllCheckboxes(className, value) {
            jq(className).each(function() { 
                   if (this.checked != value) {
                       this.click();
                   }
            });
        }
    </script>

      <dl id="geo-visible-features" class="collapsible collapsedOnLoad">
        <dt class="collapsibleHeader" i18n:translate="label_visible-features">Visible Features</dt>
        <dd class="collapsibleContent">
           <div style="margin-bottom: 1em;">
             <table class="listing" summary="Visible Features Listing">
               <thead>
                 <tr>
                    <th class="nosort"><input type="checkbox" id="visibleFeaturesCheckAll" checked="True" onclick="changeAllCheckboxes('.changeFeatureCheckbox', this.checked);" title="Click to show/hide all" /> Show</th>
                    <th>Title</th>
                    <th>Geometry</th>
                    <th>Type</th>
                 </tr>
               </thead>
               <tbody>
                 <tal:features tal:repeat="feature view/georeferencedContent">
                  <tr tal:define="placemark python:feature['feature'];
                     item_object python:placemark.dc;
                     item_type item_object/portal_type;
                     item_url item_object/absolute_url;
                     item_view_url python:(item_type in use_view_action and item_url+'/view') or item_url;">
                   <td class="listingCheckbox">
                    <input type="checkbox" onclick="doSomething" class="changeFeatureCheckbox"
                       tal:attributes="onclick string:changeFeatureVisibility(${feature/id},this.checked);;" checked="True"/> 
                   </td>
                   <td><a href="#" tal:attributes="href string:${item_view_url}; title string:${placemark/description}" tal:content="string:${placemark/name}">Title</a></td>
                   <td tal:content="string:${placemark/geom/type}">Geometry</td>
                   <td tal:content="string:${item_type}">Type</td>
                  </tr>
                 </tal:features>
               </tbody>
             </table>
           </div>
        </dd>
      </dl>
</div>
